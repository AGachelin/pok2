Code based on https://en.ittrip.xyz/c-language/c-kvm-hypervisor-guide